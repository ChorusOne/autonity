package test

import (
	"context"
	"crypto/ecdsa"
	"fmt"
	"github.com/autonity/autonity/common"
	"github.com/autonity/autonity/core"
	"github.com/autonity/autonity/core/types"
	"github.com/autonity/autonity/crypto"
	"github.com/autonity/autonity/p2p/enode"
	"github.com/autonity/autonity/params"
	"github.com/stretchr/testify/require"
	"math/big"
	"testing"
	"time"
)

const (
	treasuryFee             = 100
	minBaseFee              = 10
	delegationRate          = 1
	epochPeriod             = 5
	unBondingPeriod         = 5
	maxCommitteeSize        = 7
	blockPeriod             = 1
	defaultVersion          = "v0.0.0"
	contractUpgradeBytecode = "60806040523480156200001157600080fd5b506002601a6000600a60018154811062000030576200002f62000316565b5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060040154620000a591906200037e565b601a6000600a600181548110620000c157620000c062000316565b5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600401819055506040518060400160405280600581526020017f322e302e30000000000000000000000000000000000000000000000000000000815250600060080190805190602001906200017d92919062000266565b506103e8601960008060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555060405180602001604052806000815250601d90805190602001906200020f92919062000266565b5060405180602001604052806000815250601e90805190602001906200023792919062000266565b5060405180602001604052806000815250601f90805190602001906200025f92919062000266565b506200041b565b8280546200027490620003e5565b90600052602060002090601f016020900481019282620002985760008555620002e4565b82601f10620002b357805160ff1916838001178555620002e4565b82800160010185558215620002e4579182015b82811115620002e3578251825591602001919060010190620002c6565b5b509050620002f39190620002f7565b5090565b5b8082111562000312576000816000905550600101620002f8565b5090565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b6000819050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601260045260246000fd5b60006200038b8262000345565b9150620003988362000345565b925082620003ab57620003aa6200034f565b5b828204905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b60006002820490506001821680620003fe57607f821691505b60208210811415620004155762000414620003b6565b5b50919050565b618bcb806200042b6000396000f3fe608060405260043610620002cb5760003560e01c8063819b6463116200017b578063ae1f5fa011620000d3578063d5f394881162000085578063d5f394881462000b04578063d886f8a21462000b34578063dd62ed3e1462000b62578063e485c6fb1462000ba6578063e7f43c681462000bea578063f072929d1462000c1a57620002d3565b8063ae1f5fa014620009fb578063b66b3e791462000a15578063b7ab4db51462000a46578063c2362dd51462000a76578063c9d97af41462000aa6578063cb696f541462000ad657620002d3565b8063a416aa06116200012d578063a416aa0614620008cd578063a515366a14620008fb578063a5d059ca1462000929578063a8b2216e1462000957578063a9059cbb1462000987578063ab8f6ffe14620009cb57620002d3565b8063819b646314620007b15780638bac7dad14620007e157806395d89b41146200080f5780639bb851c0146200083f5780639c98e471146200086f5780639dc29fac146200089f57620002d3565b806340c10f19116200022f578063662cd7f411620001e1578063662cd7f414620006785780636b5f444c14620006a857806370a0823114620006d657806377e741c7146200071a578063787a2433146200074857806379502c55146200077857620002d3565b806340c10f1914620005345780634469722114620005625780634b0dff631462000592578063520fdbbc14620005c257806355230e9314620005f05780635f7d3949146200063457620002d3565b8063114eaf551162000289578063114eaf5514620003ee5780631604e416146200041c57806318160ddd146200044c5780631904bb2e146200047c57806323b872dd14620004c05780633ac25ba8146200050457620002d3565b806305261aea14620002d557806306fdde03146200031a578063095ea7b3146200034a5780630d8e6e2c146200038e5780631122063314620003be57620002d3565b36620002d357005b005b348015620002e257600080fd5b50620003016004803603810190620002fb9190620051d7565b62000c5e565b604051620003119291906200536c565b60405180910390f35b3480156200032757600080fd5b506200033262000e5a565b60405162000341919062005444565b60405180910390f35b3480156200035757600080fd5b5062000376600480360381019062000370919062005499565b62000e97565b604051620003859190620054e0565b60405180910390f35b3480156200039b57600080fd5b50620003a662000eb0565b604051620003b5919062005444565b60405180910390f35b348015620003cb57600080fd5b50620003d662000f4d565b604051620003e591906200550e565b60405180910390f35b348015620003fb57600080fd5b506200041a6004803603810190620004149190620051d7565b62000f59565b005b3480156200042957600080fd5b506200043462000ffb565b6040516200044391906200550e565b60405180910390f35b3480156200045957600080fd5b506200046462001001565b6040516200047391906200550e565b60405180910390f35b3480156200048957600080fd5b50620004a86004803603810190620004a291906200552b565b6200100b565b604051620004b79190620057c4565b60405180910390f35b348015620004cd57600080fd5b50620004ec6004803603810190620004e69190620057e8565b62001280565b604051620004fb9190620054e0565b60405180910390f35b3480156200051157600080fd5b506200051c62001336565b6040516200052b91906200550e565b60405180910390f35b3480156200054157600080fd5b506200056060048036038101906200055a919062005499565b62001350565b005b3480156200056f57600080fd5b506200057a620014e4565b6040516200058991906200550e565b60405180910390f35b3480156200059f57600080fd5b50620005aa620014ea565b604051620005b991906200550e565b60405180910390f35b348015620005cf57600080fd5b50620005ee6004803603810190620005e891906200552b565b620014f0565b005b348015620005fd57600080fd5b506200061c600480360381019062000616919062005844565b620015cb565b6040516200062b9190620059a5565b60405180910390f35b3480156200064157600080fd5b506200066060048036038101906200065a919062005844565b6200177f565b6040516200066f9190620059da565b60405180910390f35b3480156200068557600080fd5b506200069062001992565b6040516200069f91906200550e565b60405180910390f35b348015620006b557600080fd5b50620006d46004803603810190620006ce9190620051d7565b62001998565b005b348015620006e357600080fd5b50620007026004803603810190620006fc91906200552b565b62001a3a565b6040516200071191906200550e565b60405180910390f35b3480156200072757600080fd5b50620007466004803603810190620007409190620051d7565b62001a83565b005b3480156200075557600080fd5b506200076062001b25565b6040516200076f91906200550e565b60405180910390f35b3480156200078557600080fd5b506200079062001b2b565b604051620007a89a9998979695949392919062005a08565b60405180910390f35b348015620007be57600080fd5b50620007c962001c3d565b604051620007d891906200550e565b60405180910390f35b348015620007ee57600080fd5b506200080d6004803603810190620008079190620051d7565b62001c49565b005b3480156200081c57600080fd5b506200082762001d31565b60405162000836919062005444565b60405180910390f35b3480156200084c57600080fd5b506200085762001d6e565b6040516200086691906200550e565b60405180910390f35b3480156200087c57600080fd5b506200088762001d74565b6040516200089691906200550e565b60405180910390f35b348015620008ac57600080fd5b50620008cb6004803603810190620008c5919062005499565b62001d7a565b005b348015620008da57600080fd5b50620008f96004803603810190620008f3919062005c10565b62001f46565b005b3480156200090857600080fd5b5062000927600480360381019062000921919062005499565b6200204f565b005b3480156200093657600080fd5b506200095560048036038101906200094f919062005499565b620021f2565b005b3480156200096457600080fd5b506200096f62002395565b6040516200097e919062005d31565b60405180910390f35b3480156200099457600080fd5b50620009b36004803603810190620009ad919062005499565b62002478565b604051620009c29190620054e0565b60405180910390f35b348015620009d857600080fd5b50620009e362002491565b604051620009f2919062005d55565b60405180910390f35b34801562000a0857600080fd5b5062000a1362002552565b005b34801562000a2257600080fd5b5062000a2d62002f54565b60405162000a3d92919062005d79565b60405180910390f35b34801562000a5357600080fd5b5062000a5e6200308b565b60405162000a6d919062005e71565b60405180910390f35b34801562000a8357600080fd5b5062000a8e6200311b565b60405162000a9d91906200550e565b60405180910390f35b34801562000ab357600080fd5b5062000abe62003121565b60405162000acd91906200550e565b60405180910390f35b34801562000ae357600080fd5b5062000b02600480360381019062000afc9190620051d7565b62003127565b005b34801562000b1157600080fd5b5062000b1c62003202565b60405162000b2b9190620059da565b60405180910390f35b34801562000b4157600080fd5b5062000b60600480360381019062000b5a919062005ec6565b62003228565b005b34801562000b6f57600080fd5b5062000b8e600480360381019062000b88919062005ef8565b62003304565b60405162000b9d91906200550e565b60405180910390f35b34801562000bb357600080fd5b5062000bd2600480360381019062000bcc919062005844565b6200338b565b60405162000be19190620059a5565b60405180910390f35b34801562000bf757600080fd5b5062000c026200353f565b60405162000c119190620059da565b60405180910390f35b34801562000c2757600080fd5b5062000c46600480360381019062000c40919062005f3f565b6200356b565b60405162000c559190620054e0565b60405180910390f35b600060603373ffffffffffffffffffffffffffffffffffffffff16601c60009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161462000cf5576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040162000cec906200606e565b60405180910390fd5b600080601d805462000d0790620060bf565b905014159050836010600082825462000d21919062006124565b9250508190555043600060050154600c5462000d3e919062006124565b141562000d925762000d5260105462003692565b600060108190555062000d6462003976565b62000d6e62002552565b43600c819055506001600b600082825462000d8a919062006124565b925050819055505b80600e80805480602002602001604051908101604052809291908181526020016000905b8282101562000e4a57838290600052602060002090600202016040518060400160405290816000820160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020016001820154815250508152602001906001019062000db6565b5050505090509250925050915091565b60606040518060400160405280600681526020017f4e6577746f6e0000000000000000000000000000000000000000000000000000815250905090565b600062000ea633848462003a47565b6001905092915050565b60606000600801805462000ec490620060bf565b80601f016020809104026020016040519081016040528092919081815260200182805462000ef290620060bf565b801562000f435780601f1062000f175761010080835404028352916020019162000f43565b820191906000526020600020905b81548152906001019060200180831162000f2557829003601f168201915b5050505050905090565b60008060030154905090565b3373ffffffffffffffffffffffffffffffffffffffff166000800160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161462000fee576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040162000fe590620061d1565b60405180910390fd5b8060006006018190555050565b60105481565b6000601b54905090565b6200101562004ea4565b601a60008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020604051806101600160405290816000820160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020016001820160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020016002820180546200111e90620060bf565b80601f01602080910402602001604051908101604052809291908181526020018280546200114c90620060bf565b80156200119d5780601f1062001171576101008083540402835291602001916200119d565b820191906000526020600020905b8154815290600101906020018083116200117f57829003601f168201915b50505050508152602001600382015481526020016004820154815260200160058201548152602001600682015481526020016007820160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020016008820154815260200160098201548152602001600a820160009054906101000a900460ff16600281111562001260576200125f6200563f565b5b60028111156200127557620012746200563f565b5b815250509050919050565b60006200128f84848462003c1a565b600082601260008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020546200131b9190620061f3565b90506200132a85338362003a47565b60019150509392505050565b6000806007015460026200134b91906200622e565b905090565b3373ffffffffffffffffffffffffffffffffffffffff166000800160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614620013e5576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401620013dc90620061d1565b60405180910390fd5b671000000000000000811062001432576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401620014299062006305565b60405180910390fd5b80601960008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825462001483919062006124565b9250508190555080601b60008282546200149e919062006124565b925050819055507f48490b4407bb949b708ec5f514b4167f08f4969baaf78d53b05028adf369bfcf8282604051620014d892919062006327565b60405180910390a15050565b60155481565b60185481565b3373ffffffffffffffffffffffffffffffffffffffff166000800160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161462001585576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016200157c90620061d1565b60405180910390fd5b806000800160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050565b606060008383620015dd9190620061f3565b67ffffffffffffffff811115620015f957620015f862005ac9565b5b6040519080825280602002602001820160405280156200163657816020015b6200162262004f55565b815260200190600190039081620016185790505b50905060005b84846200164a9190620061f3565b811015620017745760166000828762001664919062006124565b81526020019081526020016000206040518060800160405290816000820160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020016001820160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020016002820154815260200160038201548152505082828151811062001753576200175262006354565b5b602002602001018190525080806200176b9062006383565b9150506200163c565b508091505092915050565b6000806000905060005b600e80549050811015620017e557600e8181548110620017ae57620017ad62006354565b5b90600052602060002090600202016001015482620017cd919062006124565b91508080620017dc9062006383565b91505062001789565b5060008114156200182d576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401620018249062006421565b60405180910390fd5b600083856200183d919062006124565b905060008160405160200162001854919062006468565b6040516020818303038152906040528051906020012060001c9050600083826200187f9190620064b4565b90506000805b600e805490508110156200194e57600e8181548110620018aa57620018a962006354565b5b90600052602060002090600202016001015482620018c9919062006124565b9150600182620018da9190620061f3565b83116200193857600e8181548110620018f857620018f762006354565b5b906000526020600020906002020160000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1696505050505050506200198c565b8080620019459062006383565b91505062001885565b506040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401620019839062006562565b60405180910390fd5b92915050565b60175481565b3373ffffffffffffffffffffffffffffffffffffffff166000800160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161462001a2d576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040162001a2490620061d1565b60405180910390fd5b8060006005018190555050565b6000601960008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b3373ffffffffffffffffffffffffffffffffffffffff166000800160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161462001b18576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040162001b0f90620061d1565b60405180910390fd5b8060006002018190555050565b60145481565b60008060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16908060010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169080600201549080600301549080600401549080600501549080600601549080600701549080600801805462001bae90620060bf565b80601f016020809104026020016040519081016040528092919081815260200182805462001bdc90620060bf565b801562001c2d5780601f1062001c015761010080835404028352916020019162001c2d565b820191906000526020600020905b81548152906001019060200180831162001c0f57829003601f168201915b505050505090806009015490508a565b60008060070154905090565b3373ffffffffffffffffffffffffffffffffffffffff166000800160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161462001cde576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040162001cd590620061d1565b60405180910390fd5b6000811162001d24576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040162001d1b90620065d4565b60405180910390fd5b8060006007018190555050565b60606040518060400160405280600381526020017f4e544e0000000000000000000000000000000000000000000000000000000000815250905090565b600f5481565b600d5481565b3373ffffffffffffffffffffffffffffffffffffffff166000800160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161462001e0f576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040162001e0690620061d1565b60405180910390fd5b80601960008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054101562001e94576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040162001e8b9062006646565b60405180910390fd5b80601960008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825462001ee59190620061f3565b9250508190555080601b600082825462001f009190620061f3565b925050819055507f5024dbeedf0c06664c9bd7be836915730c955e936972c020683dadf11d5488a3828260405162001f3a92919062006327565b60405180910390a15050565b60006040518061016001604052803373ffffffffffffffffffffffffffffffffffffffff168152602001600073ffffffffffffffffffffffffffffffffffffffff1681526020018381526020016000600401548152602001600081526020016000815260200160008152602001600073ffffffffffffffffffffffffffffffffffffffff168152602001600081526020014381526020016000600281111562001ff45762001ff36200563f565b5b8152509050620020048162003de4565b7f6921859367aca5023ddf910758cd0cda74261b2e5c8425c253e9d03b62b950b8338260200151848460e0015160405162002043949392919062006668565b60405180910390a15050565b8173ffffffffffffffffffffffffffffffffffffffff16601a60008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161462002122576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040162002119906200670c565b60405180910390fd5b600060028111156200213957620021386200563f565b5b601a60008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600a0160009054906101000a900460ff1660028111156200219e576200219d6200563f565b5b14620021e1576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401620021d8906200677e565b60405180910390fd5b620021ee8282336200426d565b5050565b8173ffffffffffffffffffffffffffffffffffffffff16601a60008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614620022c5576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401620022bc906200670c565b60405180910390fd5b60006002811115620022dc57620022db6200563f565b5b601a60008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600a0160009054906101000a900460ff1660028111156200234157620023406200563f565b5b1462002384576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016200237b906200677e565b60405180910390fd5b62002391828233620044bc565b5050565b60606011805480602002602001604051908101604052809291908181526020016000905b828210156200246f578382906000526020600020018054620023db90620060bf565b80601f01602080910402602001604051908101604052809291908181526020018280546200240990620060bf565b80156200245a5780601f106200242e576101008083540402835291602001916200245a565b820191906000526020600020905b8154815290600101906020018083116200243c57829003601f168201915b505050505081526020019060010190620023b9565b50505050905090565b60006200248733848462003c1a565b6001905092915050565b6060600e805480602002602001604051908101604052809291908181526020016000905b828210156200254957838290600052602060002090600202016040518060400160405290816000820160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200160018201548152505081526020019060010190620024b5565b50505050905090565b3373ffffffffffffffffffffffffffffffffffffffff16601c60009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614620025e5576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401620025dc906200606e565b60405180910390fd5b6000600a805490501162002630576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016200262790620067f0565b60405180910390fd5b6000805b600a80549050811015620027bd57600060028111156200265957620026586200563f565b5b601a6000600a848154811062002674576200267362006354565b5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600a0160009054906101000a900460ff166002811115620026ff57620026fe6200563f565b5b1480156200279057506000601a6000600a848154811062002725576200272462006354565b5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060040154115b15620027a7578180620027a39062006383565b9250505b8080620027b49062006383565b91505062002634565b50600080600701549050818110620027d3578190505b60008267ffffffffffffffff811115620027f257620027f162005ac9565b5b6040519080825280602002602001820160405280156200282f57816020015b6200281b62004ea4565b815260200190600190039081620028115790505b50905060008267ffffffffffffffff81111562002851576200285062005ac9565b5b6040519080825280602002602001820160405280156200288e57816020015b6200287a62004ea4565b815260200190600190039081620028705790505b5090506000805b600a8054905081101562002cea5760006002811115620028ba57620028b96200563f565b5b601a6000600a8481548110620028d557620028d462006354565b5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600a0160009054906101000a900460ff16600281111562002960576200295f6200563f565b5b148015620029f157506000601a6000600a848154811062002986576200298562006354565b5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060040154115b1562002cd4576000601a6000600a848154811062002a145762002a1362006354565b5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020604051806101600160405290816000820160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020016001820160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200160028201805462002b4390620060bf565b80601f016020809104026020016040519081016040528092919081815260200182805462002b7190620060bf565b801562002bc25780601f1062002b965761010080835404028352916020019162002bc2565b820191906000526020600020905b81548152906001019060200180831162002ba457829003601f168201915b50505050508152602001600382015481526020016004820154815260200160058201548152602001600682015481526020016007820160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020016008820154815260200160098201548152602001600a820160009054906101000a900460ff16600281111562002c855762002c846200563f565b5b600281111562002c9a5762002c996200563f565b5b8152505090508085848151811062002cb75762002cb662006354565b5b6020026020010181905250828062002ccf9062006383565b935050505b808062002ce19062006383565b91505062002895565b506000600701548351111562002d725762002d0583620047e7565b60005b60006007015481101562002d6b5783818151811062002d2c5762002d2b62006354565b5b602002602001015183828151811062002d4a5762002d4962006354565b5b6020026020010181905250808062002d629062006383565b91505062002d08565b5062002d76565b8291505b600e600062002d86919062004fa9565b6011600062002d96919062004fcf565b6000600d8190555060005b8481101562002f4c576000604051806040016040528085848151811062002dcd5762002dcc62006354565b5b60200260200101516020015173ffffffffffffffffffffffffffffffffffffffff16815260200185848151811062002e0a5762002e0962006354565b5b6020026020010151608001518152509050600e81908060018154018082558091505060019003906000526020600020906002020160009091909190915060008201518160000160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550602082015181600101555050601184838151811062002eb25762002eb162006354565b5b60200260200101516040015190806001815401808255809150506001900390600052602060002001600090919091909150908051906020019062002ef892919062004ff2565b5083828151811062002f0f5762002f0e62006354565b5b602002602001015160800151600d600082825462002f2e919062006124565b9250508190555050808062002f439062006383565b91505062002da1565b505050505050565b606080601d601e81805462002f6990620060bf565b80601f016020809104026020016040519081016040528092919081815260200182805462002f9790620060bf565b801562002fe85780601f1062002fbc5761010080835404028352916020019162002fe8565b820191906000526020600020905b81548152906001019060200180831162002fca57829003601f168201915b5050505050915080805462002ffd90620060bf565b80601f01602080910402602001604051908101604052809291908181526020018280546200302b90620060bf565b80156200307c5780601f1062003050576101008083540402835291602001916200307c565b820191906000526020600020905b8154815290600101906020018083116200305e57829003601f168201915b50505050509050915091509091565b6060600a8054806020026020016040519081016040528092919081815260200182805480156200311157602002820191906000526020600020905b8160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019060010190808311620030c6575b5050505050905090565b600c5481565b600b5481565b3373ffffffffffffffffffffffffffffffffffffffff166000800160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614620031bc576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401620031b390620061d1565b60405180910390fd5b806000600301819055507f1f4d2fc7529047a5bd96d3229bfea127fd18b7748f13586e097c69fccd38912881604051620031f791906200550e565b60405180910390a150565b601c60009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b3373ffffffffffffffffffffffffffffffffffffffff166000800160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614620032bd576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401620032b490620061d1565b60405180910390fd5b80600060010160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050565b6000601260008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905092915050565b6060600083836200339d9190620061f3565b67ffffffffffffffff811115620033b957620033b862005ac9565b5b604051908082528060200260200182016040528015620033f657816020015b620033e262004f55565b815260200190600190039081620033d85790505b50905060005b84846200340a9190620061f3565b811015620035345760136000828762003424919062006124565b81526020019081526020016000206040518060800160405290816000820160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020016001820160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020016002820154815260200160038201548152505082828151811062003513576200351262006354565b5b602002602001018190525080806200352b9062006383565b915050620033fc565b508091505092915050565b60008060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b60003373ffffffffffffffffffffffffffffffffffffffff166000800160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161462003602576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401620035f990620061d1565b60405180910390fd5b83601d90805190602001906200361a92919062004ff2565b5082601e90805190602001906200363392919062004ff2565b5081601f90805190602001906200364c92919062004ff2565b507fb8751b0dd53b85bff7c80c820320c0c7993e4af340a036b112cb9b5714106a61601f6040516200367f9190620068b3565b60405180910390a1600190509392505050565b80471015620036d8576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401620036cf906200694d565b60405180910390fd5b6000670de0b6b3a764000082600060020154620036f691906200622e565b6200370291906200696f565b905060008111156200378c57600060010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f193505050501580156200377a573d6000803e3d6000fd5b508082620037899190620061f3565b91505b81600f6000828254620037a0919062006124565b9250508190555060005b600e8054905081101562003971576000601a6000600e8481548110620037d557620037d462006354565b5b906000526020600020906002020160000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002090506000600d548583600401546200385a91906200622e565b6200386691906200696f565b90506000811115620038fa578160070160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663fb489a7b826040518263ffffffff1660e01b81526004016000604051808303818588803b158015620038df57600080fd5b505af1158015620038f4573d6000803e3d6000fd5b50505050505b7fb3b7a071186534c03b40695710096f289fd4ed6c1a374aff0bb648955e4fe5638260010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16826040516200395192919062006327565b60405180910390a150508080620039689062006383565b915050620037aa565b505050565b600060145490505b601554811015620039aa57620039948162004807565b8080620039a19062006383565b9150506200397e565b5060155460148190555060006017549050600060175490505b60185481101562003a3c57436000600601546016600084815260200190815260200160002060030154620039f8919062006124565b1162003a205762003a098162004a67565b60018262003a18919062006124565b915062003a26565b62003a3c565b808062003a339062006383565b915050620039c3565b508060178190555050565b600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff16141562003aba576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040162003ab19062006a1d565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff16141562003b2d576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040162003b249062006ab5565b60405180910390fd5b80601260008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9258360405162003c0d91906200550e565b60405180910390a3505050565b80601960008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054101562003c9f576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040162003c969062006b27565b60405180910390fd5b80601960008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825462003cf09190620061f3565b9250508190555080601b600082825462003d0b919062006124565b9250508190555080600262003d2191906200622e565b601960008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825462003d71919062006124565b925050819055508173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef8360405162003dd791906200550e565b60405180910390a3505050565b600062003df5826040015162004c6b565b836020018193508273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681525050506000811462003e74576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040162003e6b9062006b99565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff16601a6000846020015173ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161462003f4c576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040162003f439062006c0b565b60405180910390fd5b633b9aca008260600151111562003f9a576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040162003f919062006c7d565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168260e0015173ffffffffffffffffffffffffffffffffffffffff161415620040555781602001518260000151836060015160405162003ff19062005083565b62003fff9392919062006c9f565b604051809103906000f0801580156200401c573d6000803e3d6000fd5b508260e0019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff16815250505b600a82602001519080600181540180825580915050600190039060005260206000200160009091909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555081601a6000846020015173ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008201518160000160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060208201518160010160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506040820151816002019080519060200190620041ac92919062004ff2565b50606082015181600301556080820151816004015560a0820151816005015560c0820151816006015560e08201518160070160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506101008201518160080155610120820151816009015561014082015181600a0160006101000a81548160ff021916908360028111156200426157620042606200563f565b5b02179055509050505050565b60008211620042b3576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401620042aa9062006d52565b60405180910390fd5b81601960008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054101562004338576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016200432f9062006dc4565b60405180910390fd5b81601960008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254620043899190620061f3565b92505081905550600060405180608001604052808373ffffffffffffffffffffffffffffffffffffffff1681526020018573ffffffffffffffffffffffffffffffffffffffff1681526020018481526020014381525090508060136000601554815260200190815260200160002060008201518160000160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060208201518160010160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550604082015181600201556060820151816003015590505060156000815480929190620044b19062006383565b919050555050505050565b6000601a60008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060070160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166370a08231836040518263ffffffff1660e01b81526004016200455b919062006e0b565b602060405180830381865afa15801562004579573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906200459f919062006e3f565b905082811015620045e7576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401620045de9062006ee7565b60405180910390fd5b601a60008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060070160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16639dc29fac83856040518363ffffffff1660e01b81526004016200468692919062006f09565b600060405180830381600087803b158015620046a157600080fd5b505af1158015620046b6573d6000803e3d6000fd5b50505050600060405180608001604052808473ffffffffffffffffffffffffffffffffffffffff1681526020018673ffffffffffffffffffffffffffffffffffffffff1681526020018581526020014381525090508060166000601854815260200190815260200160002060008201518160000160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060208201518160010160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550604082015181600201556060820151816003015590505060186000815480929190620047db9062006383565b91905055505050505050565b6200480481600060018451620047fe9190620061f3565b62004ccc565b50565b60006013600083815260200190815260200160002090506000601a60008360010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020905060008082600401541415620048a15782600201549050620048cb565b816004015483600201548360080154620048bc91906200622e565b620048c891906200696f565b90505b8160070160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166340c10f198460000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16836040518363ffffffff1660e01b81526004016200495092919062006f09565b600060405180830381600087803b1580156200496b57600080fd5b505af115801562004980573d6000803e3d6000fd5b5050505082600201548260040160008282546200499e919062006124565b925050819055508160000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168360000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16141562004a4457826002015482600501600082825462004a3c919062006124565b925050819055505b8082600801600082825462004a5a919062006124565b9250508190555050505050565b60006016600083815260200190815260200160002090506000601a60008360010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000209050600081600801548260040154846002015462004b0291906200622e565b62004b0e91906200696f565b90508082600401600082825462004b269190620061f3565b925050819055508160000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168360000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16141562004bc8578082600501600082825462004bc09190620061f3565b925050819055505b826002015482600801600082825462004be29190620061f3565b9250508190555080601960008560000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825462004c5e919062006124565b9250508190555050505050565b60008062004c7862005091565b600060408286516020880160ff5afa62004c9157600080fd5b6c010000000000000000000000008251049050808260016002811062004cbc5762004cbb62006354565b5b6020020151935093505050915091565b600082905060008290508082141562004ce757505062004e9f565b6000856002868662004cfa919062006f40565b62004d06919062006fde565b8662004d13919062007052565b8151811062004d275762004d2662006354565b5b60200260200101516080015190505b81831362004e6d575b8086848151811062004d565762004d5562006354565b5b602002602001015160800151111562004d7f57828062004d7690620070f0565b93505062004d3f565b5b85828151811062004d965762004d9562006354565b5b60200260200101516080015181111562004dc057818062004db7906200713e565b92505062004d80565b81831362004e675785828151811062004dde5762004ddd62006354565b5b602002602001015186848151811062004dfc5762004dfb62006354565b5b602002602001015187858151811062004e1a5762004e1962006354565b5b6020026020010188858151811062004e375762004e3662006354565b5b602002602001018290528290525050828062004e5390620070f0565b935050818062004e63906200713e565b9250505b62004d36565b8185121562004e845762004e8386868462004ccc565b5b8383121562004e9b5762004e9a86848662004ccc565b5b5050505b505050565b604051806101600160405280600073ffffffffffffffffffffffffffffffffffffffff168152602001600073ffffffffffffffffffffffffffffffffffffffff1681526020016060815260200160008152602001600081526020016000815260200160008152602001600073ffffffffffffffffffffffffffffffffffffffff16815260200160008152602001600081526020016000600281111562004f4f5762004f4e6200563f565b5b81525090565b6040518060800160405280600073ffffffffffffffffffffffffffffffffffffffff168152602001600073ffffffffffffffffffffffffffffffffffffffff16815260200160008152602001600081525090565b508054600082556002029060005260206000209081019062004fcc9190620050b3565b50565b508054600082559060005260206000209081019062004fef9190620050fb565b50565b8280546200500090620060bf565b90600052602060002090601f01602090048101928262005024576000855562005070565b82601f106200503f57805160ff191683800117855562005070565b8280016001018555821562005070579182015b828111156200506f57825182559160200191906001019062005052565b5b5090506200507f919062005123565b5090565b611a09806200718d83390190565b6040518060400160405280600290602082028036833780820191505090505090565b5b80821115620050f757600080820160006101000a81549073ffffffffffffffffffffffffffffffffffffffff0219169055600182016000905550600201620050b4565b5090565b5b808211156200511f576000818162005115919062005142565b50600101620050fc565b5090565b5b808211156200513e57600081600090555060010162005124565b5090565b5080546200515090620060bf565b6000825580601f1062005164575062005185565b601f01602090049060005260206000209081019062005184919062005123565b5b50565b6000604051905090565b600080fd5b600080fd5b6000819050919050565b620051b1816200519c565b8114620051bd57600080fd5b50565b600081359050620051d181620051a6565b92915050565b600060208284031215620051f057620051ef62005192565b5b60006200520084828501620051c0565b91505092915050565b60008115159050919050565b620052208162005209565b82525050565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60006200527f8262005252565b9050919050565b620052918162005272565b82525050565b620052a2816200519c565b82525050565b604082016000820151620052c0600085018262005286565b506020820151620052d5602085018262005297565b50505050565b6000620052e98383620052a8565b60408301905092915050565b6000602082019050919050565b60006200530f8262005226565b6200531b818562005231565b9350620053288362005242565b8060005b838110156200535f578151620053438882620052db565b97506200535083620052f5565b9250506001810190506200532c565b5085935050505092915050565b600060408201905062005383600083018562005215565b818103602083015262005397818462005302565b90509392505050565b600081519050919050565b600082825260208201905092915050565b60005b83811015620053dc578082015181840152602081019050620053bf565b83811115620053ec576000848401525b50505050565b6000601f19601f8301169050919050565b60006200541082620053a0565b6200541c8185620053ab565b93506200542e818560208601620053bc565b6200543981620053f2565b840191505092915050565b6000602082019050818103600083015262005460818462005403565b905092915050565b620054738162005272565b81146200547f57600080fd5b50565b600081359050620054938162005468565b92915050565b60008060408385031215620054b357620054b262005192565b5b6000620054c38582860162005482565b9250506020620054d685828601620051c0565b9150509250929050565b6000602082019050620054f7600083018462005215565b92915050565b62005508816200519c565b82525050565b6000602082019050620055256000830184620054fd565b92915050565b60006020828403121562005544576200554362005192565b5b6000620055548482850162005482565b91505092915050565b60006200556a8262005252565b9050919050565b6200557c816200555d565b82525050565b600082825260208201905092915050565b6000620055a082620053a0565b620055ac818562005582565b9350620055be818560208601620053bc565b620055c981620053f2565b840191505092915050565b6000819050919050565b6000620055ff620055f9620055f38462005252565b620055d4565b62005252565b9050919050565b60006200561382620055de565b9050919050565b6000620056278262005606565b9050919050565b62005639816200561a565b82525050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602160045260246000fd5b600381106200568257620056816200563f565b5b50565b600081905062005695826200566e565b919050565b6000620056a78262005685565b9050919050565b620056b9816200569a565b82525050565b600061016083016000830151620056da600086018262005571565b506020830151620056ef602086018262005286565b506040830151848203604086015262005709828262005593565b915050606083015162005720606086018262005297565b50608083015162005735608086018262005297565b5060a08301516200574a60a086018262005297565b5060c08301516200575f60c086018262005297565b5060e08301516200577460e08601826200562e565b506101008301516200578b61010086018262005297565b50610120830151620057a261012086018262005297565b50610140830151620057b9610140860182620056ae565b508091505092915050565b60006020820190508181036000830152620057e08184620056bf565b905092915050565b60008060006060848603121562005804576200580362005192565b5b6000620058148682870162005482565b9350506020620058278682870162005482565b92505060406200583a86828701620051c0565b9150509250925092565b600080604083850312156200585e576200585d62005192565b5b60006200586e85828601620051c0565b92505060206200588185828601620051c0565b9150509250929050565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b608082016000820151620058cf600085018262005571565b506020820151620058e4602085018262005286565b506040820151620058f9604085018262005297565b5060608201516200590e606085018262005297565b50505050565b6000620059228383620058b7565b60808301905092915050565b6000602082019050919050565b600062005948826200588b565b62005954818562005896565b93506200596183620058a7565b8060005b83811015620059985781516200597c888262005914565b975062005989836200592e565b92505060018101905062005965565b5085935050505092915050565b60006020820190508181036000830152620059c181846200593b565b905092915050565b620059d48162005272565b82525050565b6000602082019050620059f16000830184620059c9565b92915050565b62005a02816200555d565b82525050565b60006101408201905062005a20600083018d620059c9565b62005a2f602083018c620059f7565b62005a3e604083018b620054fd565b62005a4d606083018a620054fd565b62005a5c6080830189620054fd565b62005a6b60a0830188620054fd565b62005a7a60c0830187620054fd565b62005a8960e0830186620054fd565b81810361010083015262005a9e818562005403565b905062005ab0610120830184620054fd565b9b9a5050505050505050505050565b600080fd5b600080fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b62005b0382620053f2565b810181811067ffffffffffffffff8211171562005b255762005b2462005ac9565b5b80604052505050565b600062005b3a62005188565b905062005b48828262005af8565b919050565b600067ffffffffffffffff82111562005b6b5762005b6a62005ac9565b5b62005b7682620053f2565b9050602081019050919050565b82818337600083830152505050565b600062005ba962005ba38462005b4d565b62005b2e565b90508281526020810184848401111562005bc85762005bc762005ac4565b5b62005bd584828562005b83565b509392505050565b600082601f83011262005bf55762005bf462005abf565b5b813562005c0784826020860162005b92565b91505092915050565b60006020828403121562005c295762005c2862005192565b5b600082013567ffffffffffffffff81111562005c4a5762005c4962005197565b5b62005c588482850162005bdd565b91505092915050565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b600062005c9b838362005593565b905092915050565b6000602082019050919050565b600062005cbd8262005c61565b62005cc9818562005c6c565b93508360208202850162005cdd8562005c7d565b8060005b8581101562005d1f578484038952815162005cfd858262005c8d565b945062005d0a8362005ca3565b925060208a0199505060018101905062005ce1565b50829750879550505050505092915050565b6000602082019050818103600083015262005d4d818462005cb0565b905092915050565b6000602082019050818103600083015262005d71818462005302565b905092915050565b6000604082019050818103600083015262005d95818562005403565b9050818103602083015262005dab818462005403565b90509392505050565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b600062005dee838362005286565b60208301905092915050565b6000602082019050919050565b600062005e148262005db4565b62005e20818562005dbf565b935062005e2d8362005dd0565b8060005b8381101562005e6457815162005e48888262005de0565b975062005e558362005dfa565b92505060018101905062005e31565b5085935050505092915050565b6000602082019050818103600083015262005e8d818462005e07565b905092915050565b62005ea0816200555d565b811462005eac57600080fd5b50565b60008135905062005ec08162005e95565b92915050565b60006020828403121562005edf5762005ede62005192565b5b600062005eef8482850162005eaf565b91505092915050565b6000806040838503121562005f125762005f1162005192565b5b600062005f228582860162005482565b925050602062005f358582860162005482565b9150509250929050565b60008060006060848603121562005f5b5762005f5a62005192565b5b600084013567ffffffffffffffff81111562005f7c5762005f7b62005197565b5b62005f8a8682870162005bdd565b935050602084013567ffffffffffffffff81111562005fae5762005fad62005197565b5b62005fbc8682870162005bdd565b925050604084013567ffffffffffffffff81111562005fe05762005fdf62005197565b5b62005fee8682870162005bdd565b9150509250925092565b7f66756e6374696f6e207265737472696374656420746f207468652070726f746f60008201527f636f6c0000000000000000000000000000000000000000000000000000000000602082015250565b600062006056602383620053ab565b9150620060638262005ff8565b604082019050919050565b60006020820190508181036000830152620060898162006047565b9050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b60006002820490506001821680620060d857607f821691505b60208210811415620060ef57620060ee62006090565b5b50919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b600062006131826200519c565b91506200613e836200519c565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff03821115620061765762006175620060f5565b5b828201905092915050565b7f63616c6c6572206973206e6f7420746865206f70657261746f72000000000000600082015250565b6000620061b9601a83620053ab565b9150620061c68262006181565b602082019050919050565b60006020820190508181036000830152620061ec81620061aa565b9050919050565b600062006200826200519c565b91506200620d836200519c565b925082821015620062235762006222620060f5565b5b828203905092915050565b60006200623b826200519c565b915062006248836200519c565b9250817fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0483118215151615620062845762006283620060f5565b5b828202905092915050565b7f697373756564204e6577746f6e2063616e27742062652067726561746572207460008201527f68616e20325e3630000000000000000000000000000000000000000000000000602082015250565b6000620062ed602883620053ab565b9150620062fa826200628f565b604082019050919050565b600060208201905081810360008301526200632081620062de565b9050919050565b60006040820190506200633e6000830185620059c9565b6200634d6020830184620054fd565b9392505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b600062006390826200519c565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff821415620063c657620063c5620060f5565b5b600182019050919050565b7f54686520636f6d6d6974746565206973206e6f74207374616b696e6700000000600082015250565b600062006409601c83620053ab565b91506200641682620063d1565b602082019050919050565b600060208201905081810360008301526200643c81620063fa565b9050919050565b6000819050919050565b620064626200645c826200519c565b62006443565b82525050565b60006200647682846200644d565b60208201915081905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601260045260246000fd5b6000620064c1826200519c565b9150620064ce836200519c565b925082620064e157620064e062006485565b5b828206905092915050565b7f5468657265206973206e6f2076616c696461746f72206c65667420696e20746860008201527f65206e6574776f726b0000000000000000000000000000000000000000000000602082015250565b60006200654a602983620053ab565b91506200655782620064ec565b604082019050919050565b600060208201905081810360008301526200657d816200653b565b9050919050565b7f636f6d6d69747465652073697a652063616e2774206265203000000000000000600082015250565b6000620065bc601983620053ab565b9150620065c98262006584565b602082019050919050565b60006020820190508181036000830152620065ef81620065ad565b9050919050565b7f416d6f756e7420657863656564732062616c616e636500000000000000000000600082015250565b60006200662e601683620053ab565b91506200663b82620065f6565b602082019050919050565b6000602082019050818103600083015262006661816200661f565b9050919050565b60006080820190506200667f6000830187620059c9565b6200668e6020830186620059c9565b8181036040830152620066a2818562005403565b9050620066b36060830184620059c9565b95945050505050565b7f76616c696461746f72206e6f7420726567697374657265640000000000000000600082015250565b6000620066f4601883620053ab565b91506200670182620066bc565b602082019050919050565b600060208201905081810360008301526200672781620066e5565b9050919050565b7f76616c696461746f72206e65656420746f20626520656e61626c656400000000600082015250565b600062006766601c83620053ab565b915062006773826200672e565b602082019050919050565b60006020820190508181036000830152620067998162006757565b9050919050565b7f5468657265206d7573742062652076616c696461746f72730000000000000000600082015250565b6000620067d8601883620053ab565b9150620067e582620067a0565b602082019050919050565b600060208201905081810360008301526200680b81620067c9565b9050919050565b60008190508160005260206000209050919050565b600081546200683681620060bf565b620068428186620053ab565b945060018216600081146200686057600181146200687357620068aa565b60ff1983168652602086019350620068aa565b6200687e8562006812565b60005b83811015620068a25781548189015260018201915060208101905062006881565b808801955050505b50505092915050565b60006020820190508181036000830152620068cf818462006827565b905092915050565b7f6e6f7420656e6f7567682066756e647320746f20706572666f726d207265646960008201527f73747269627574696f6e00000000000000000000000000000000000000000000602082015250565b600062006935602a83620053ab565b91506200694282620068d7565b604082019050919050565b60006020820190508181036000830152620069688162006926565b9050919050565b60006200697c826200519c565b915062006989836200519c565b9250826200699c576200699b62006485565b5b828204905092915050565b7f45524332303a20617070726f76652066726f6d20746865207a65726f2061646460008201527f7265737300000000000000000000000000000000000000000000000000000000602082015250565b600062006a05602483620053ab565b915062006a1282620069a7565b604082019050919050565b6000602082019050818103600083015262006a3881620069f6565b9050919050565b7f45524332303a20617070726f766520746f20746865207a65726f20616464726560008201527f7373000000000000000000000000000000000000000000000000000000000000602082015250565b600062006a9d602283620053ab565b915062006aaa8262006a3f565b604082019050919050565b6000602082019050818103600083015262006ad08162006a8e565b9050919050565b7f616d6f756e7420657863656564732062616c616e636500000000000000000000600082015250565b600062006b0f601683620053ab565b915062006b1c8262006ad7565b602082019050919050565b6000602082019050818103600083015262006b428162006b00565b9050919050565b7f656e6f6465206572726f72000000000000000000000000000000000000000000600082015250565b600062006b81600b83620053ab565b915062006b8e8262006b49565b602082019050919050565b6000602082019050818103600083015262006bb48162006b72565b9050919050565b7f76616c696461746f7220616c7265616479207265676973746572656400000000600082015250565b600062006bf3601c83620053ab565b915062006c008262006bbb565b602082019050919050565b6000602082019050818103600083015262006c268162006be4565b9050919050565b7f696e76616c696420636f6d6d697373696f6e2072617465000000000000000000600082015250565b600062006c65601783620053ab565b915062006c728262006c2d565b602082019050919050565b6000602082019050818103600083015262006c988162006c56565b9050919050565b600060608201905062006cb66000830186620059c9565b62006cc56020830185620059f7565b62006cd46040830184620054fd565b949350505050565b7f616d6f756e74206e65656420746f206265207374726963746c7920706f73697460008201527f6976650000000000000000000000000000000000000000000000000000000000602082015250565b600062006d3a602383620053ab565b915062006d478262006cdc565b604082019050919050565b6000602082019050818103600083015262006d6d8162006d2b565b9050919050565b7f696e73756666696369656e74204e6577746f6e2062616c616e63650000000000600082015250565b600062006dac601b83620053ab565b915062006db98262006d74565b602082019050919050565b6000602082019050818103600083015262006ddf8162006d9d565b9050919050565b600062006df38262005606565b9050919050565b62006e058162006de6565b82525050565b600060208201905062006e22600083018462006dfa565b92915050565b60008151905062006e3981620051a6565b92915050565b60006020828403121562006e585762006e5762005192565b5b600062006e688482850162006e28565b91505092915050565b7f696e73756666696369656e74204c6971756964204e6577746f6e2062616c616e60008201527f6365000000000000000000000000000000000000000000000000000000000000602082015250565b600062006ecf602283620053ab565b915062006edc8262006e71565b604082019050919050565b6000602082019050818103600083015262006f028162006ec0565b9050919050565b600060408201905062006f206000830185620059f7565b62006f2f6020830184620054fd565b9392505050565b6000819050919050565b600062006f4d8262006f36565b915062006f5a8362006f36565b9250827f80000000000000000000000000000000000000000000000000000000000000000182126000841215161562006f985762006f97620060f5565b5b827f7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff01821360008412161562006fd35762006fd2620060f5565b5b828203905092915050565b600062006feb8262006f36565b915062006ff88362006f36565b9250826200700b576200700a62006485565b5b600160000383147f800000000000000000000000000000000000000000000000000000000000000083141615620070475762007046620060f5565b5b828205905092915050565b60006200705f8262006f36565b91506200706c8362006f36565b9250817f7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff03831360008312151615620070aa57620070a9620060f5565b5b817f8000000000000000000000000000000000000000000000000000000000000000038312600083121615620070e557620070e4620060f5565b5b828201905092915050565b6000620070fd8262006f36565b91507f7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff821415620071335762007132620060f5565b5b600182019050919050565b60006200714b8262006f36565b91507f8000000000000000000000000000000000000000000000000000000000000000821415620071815762007180620060f5565b5b60018203905091905056fe60806040523480156200001157600080fd5b5060405162001a0938038062001a098339818101604052810190620000379190620001f3565b82600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555081600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555080600481905550336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505050506200024f565b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60006200013b826200010e565b9050919050565b6200014d816200012e565b81146200015957600080fd5b50565b6000815190506200016d8162000142565b92915050565b600062000180826200010e565b9050919050565b620001928162000173565b81146200019e57600080fd5b50565b600081519050620001b28162000187565b92915050565b6000819050919050565b620001cd81620001b8565b8114620001d957600080fd5b50565b600081519050620001ed81620001c2565b92915050565b6000806000606084860312156200020f576200020e62000109565b5b60006200021f868287016200015c565b93505060206200023286828701620001a1565b92505060406200024586828701620001dc565b9150509250925092565b6117aa806200025f6000396000f3fe6080604052600436106100915760003560e01c806370a082311161005957806370a082311461018f5780639dc29fac146101cc578063a9059cbb146101f5578063dd62ed3e14610232578063fb489a7b1461026f57610091565b8063047fc9aa14610096578063095ea7b3146100c157806318160ddd146100fe57806323b872dd1461012957806340c10f1914610166575b600080fd5b3480156100a257600080fd5b506100ab610279565b6040516100b89190610ff1565b60405180910390f35b3480156100cd57600080fd5b506100e860048036038101906100e3919061109b565b61027f565b6040516100f591906110f6565b60405180910390f35b34801561010a57600080fd5b50610113610296565b6040516101209190610ff1565b60405180910390f35b34801561013557600080fd5b50610150600480360381019061014b9190611111565b6102a0565b60405161015d91906110f6565b60405180910390f35b34801561017257600080fd5b5061018d600480360381019061018891906111a2565b610350565b005b34801561019b57600080fd5b506101b660048036038101906101b191906111e2565b6105c9565b6040516101c39190610ff1565b60405180910390f35b3480156101d857600080fd5b506101f360048036038101906101ee91906111a2565b610615565b005b34801561020157600080fd5b5061021c6004803603810190610217919061109b565b6107f3565b60405161022991906110f6565b60405180910390f35b34801561023e57600080fd5b506102596004803603810190610254919061120f565b61080a565b6040516102669190610ff1565b60405180910390f35b610277610891565b005b60035481565b600061028c338484610abc565b6001905092915050565b6000600354905090565b60006102ad848484610c87565b600082600760008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054610337919061127e565b9050610344853383610abc565b60019150509392505050565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146103de576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016103d590611335565b60405180910390fd5b60008111610421576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610418906113a1565b60405180910390fd5b6000600660008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600001541415610553576005829080600181540180825580915050600190039060005260206000200160009091909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550600060405180604001604052806000815260200160016005805490506104f5919061127e565b815250905080600660008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000820151816000015560208201518160010155905050505b80600660008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160008282546105a591906113c1565b9250508190555080600360008282546105be91906113c1565b925050819055505050565b6000600660008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600001549050919050565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146106a3576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161069a90611335565b60405180910390fd5b80600660008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600001541015610728576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161071f90611463565b60405180910390fd5b80600660008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600001600082825461077a919061127e565b925050819055508060036000828254610793919061127e565b925050819055506000600660008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000015414156107ef576107ee82610e28565b5b5050565b6000610800338484610c87565b6001905092915050565b6000600760008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905092915050565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461091f576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161091690611335565b60405180910390fd5b60003490506000612710600454836109379190611483565b610941919061150c565b9050600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f193505050501580156109ab573d6000803e3d6000fd5b5080826109b8919061127e565b915060005b600580549050811015610ab7576000600582815481106109e0576109df61153d565b5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690506000600354600660008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000015486610a609190611483565b610a6a919061150c565b90508173ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f193505050505050508080610aaf9061156c565b9150506109bd565b505050565b600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff161415610b2c576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610b2390611627565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff161415610b9c576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610b93906116b9565b60405180910390fd5b80600760008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b92583604051610c7a9190610ff1565b60405180910390a3505050565b80600660008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600001541015610d0c576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610d0390611725565b60405180910390fd5b80600660008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000016000828254610d5e919061127e565b9250508190555080600660008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000016000828254610db791906113c1565b925050819055508173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef83604051610e1b9190610ff1565b60405180910390a3505050565b6000600660008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020604051806040016040529081600082015481526020016001820154815250509050600081602001519050600060056001600580549050610ea9919061127e565b81548110610eba57610eb961153d565b5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690508060058381548110610efc57610efb61153d565b5b9060005260206000200160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555081600660008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600101819055506005805480610f9d57610f9c611745565b5b6001900381819060005260206000200160006101000a81549073ffffffffffffffffffffffffffffffffffffffff0219169055905550505050565b6000819050919050565b610feb81610fd8565b82525050565b60006020820190506110066000830184610fe2565b92915050565b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b600061103c82611011565b9050919050565b61104c81611031565b811461105757600080fd5b50565b60008135905061106981611043565b92915050565b61107881610fd8565b811461108357600080fd5b50565b6000813590506110958161106f565b92915050565b600080604083850312156110b2576110b161100c565b5b60006110c08582860161105a565b92505060206110d185828601611086565b9150509250929050565b60008115159050919050565b6110f0816110db565b82525050565b600060208201905061110b60008301846110e7565b92915050565b60008060006060848603121561112a5761112961100c565b5b60006111388682870161105a565b93505060206111498682870161105a565b925050604061115a86828701611086565b9150509250925092565b600061116f82611011565b9050919050565b61117f81611164565b811461118a57600080fd5b50565b60008135905061119c81611176565b92915050565b600080604083850312156111b9576111b861100c565b5b60006111c78582860161118d565b92505060206111d885828601611086565b9150509250929050565b6000602082840312156111f8576111f761100c565b5b60006112068482850161105a565b91505092915050565b600080604083850312156112265761122561100c565b5b60006112348582860161105a565b92505060206112458582860161105a565b9150509250929050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b600061128982610fd8565b915061129483610fd8565b9250828210156112a7576112a661124f565b5b828203905092915050565b600082825260208201905092915050565b7f43616c6c207265737472696374656420746f20746865204175746f6e6974792060008201527f436f6e7472616374000000000000000000000000000000000000000000000000602082015250565b600061131f6028836112b2565b915061132a826112c3565b604082019050919050565b6000602082019050818103600083015261134e81611312565b9050919050565b7f616d6f756e74206d757374206265207374726963746c7920706f736974697665600082015250565b600061138b6020836112b2565b915061139682611355565b602082019050919050565b600060208201905081810360008301526113ba8161137e565b9050919050565b60006113cc82610fd8565b91506113d783610fd8565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0382111561140c5761140b61124f565b5b828201905092915050565b7f616464726573732062616c616e6365206e6f742073756666696369656e740000600082015250565b600061144d601e836112b2565b915061145882611417565b602082019050919050565b6000602082019050818103600083015261147c81611440565b9050919050565b600061148e82610fd8565b915061149983610fd8565b9250817fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff04831182151516156114d2576114d161124f565b5b828202905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601260045260246000fd5b600061151782610fd8565b915061152283610fd8565b925082611532576115316114dd565b5b828204905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b600061157782610fd8565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8214156115aa576115a961124f565b5b600182019050919050565b7f45524332303a20617070726f76652066726f6d20746865207a65726f2061646460008201527f7265737300000000000000000000000000000000000000000000000000000000602082015250565b60006116116024836112b2565b915061161c826115b5565b604082019050919050565b6000602082019050818103600083015261164081611604565b9050919050565b7f45524332303a20617070726f766520746f20746865207a65726f20616464726560008201527f7373000000000000000000000000000000000000000000000000000000000000602082015250565b60006116a36022836112b2565b91506116ae82611647565b604082019050919050565b600060208201905081810360008301526116d281611696565b9050919050565b7f616d6f756e7420657863656564732062616c616e636500000000000000000000600082015250565b600061170f6016836112b2565b915061171a826116d9565b602082019050919050565b6000602082019050818103600083015261173e81611702565b9050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603160045260246000fdfea26469706673582212202e71af90117f7972ec06c8150db4e119d66c4d4563e3dca4285f089d51cb24d064736f6c634300080a0033a2646970667358221220c76cd2c613cbbec5ed518c3cc83bb6ab5d01091e32698d99241a45fc0c441a7364736f6c634300080a0033"
	contractUpgradeABI      = "[{\"inputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"owner\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"spender\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"value\",\"type\":\"uint256\"}],\"name\":\"Approval\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"internalType\":\"address\",\"name\":\"addr\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"BurnedStake\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"internalType\":\"string\",\"name\":\"version\",\"type\":\"string\"}],\"name\":\"ContractUpgraded\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"gasPrice\",\"type\":\"uint256\"}],\"name\":\"MinimumBaseFeeUpdated\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"internalType\":\"address\",\"name\":\"addr\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"MintedStake\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"internalType\":\"address\",\"name\":\"treasury\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"address\",\"name\":\"addr\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"string\",\"name\":\"enode\",\"type\":\"string\"},{\"indexed\":false,\"internalType\":\"address\",\"name\":\"liquidContract\",\"type\":\"address\"}],\"name\":\"RegisteredValidator\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"internalType\":\"address\",\"name\":\"addr\",\"type\":\"address\"}],\"name\":\"RemovedValidator\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"internalType\":\"address\",\"name\":\"addr\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"Rewarded\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"from\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"to\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"value\",\"type\":\"uint256\"}],\"name\":\"Transfer\",\"type\":\"event\"},{\"stateMutability\":\"payable\",\"type\":\"fallback\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"owner\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"spender\",\"type\":\"address\"}],\"name\":\"allowance\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"spender\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"approve\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"_addr\",\"type\":\"address\"}],\"name\":\"balanceOf\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"_validator\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"_amount\",\"type\":\"uint256\"}],\"name\":\"bond\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"_addr\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"_amount\",\"type\":\"uint256\"}],\"name\":\"burn\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"computeCommittee\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"config\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"operatorAccount\",\"type\":\"address\"},{\"internalType\":\"address payable\",\"name\":\"treasuryAccount\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"treasuryFee\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"minBaseFee\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"delegationRate\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"epochPeriod\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"unbondingPeriod\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"committeeSize\",\"type\":\"uint256\"},{\"internalType\":\"string\",\"name\":\"contractVersion\",\"type\":\"string\"},{\"internalType\":\"uint256\",\"name\":\"blockPeriod\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"deployer\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"epochID\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"epochReward\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"epochTotalBondedStake\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"finalize\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"},{\"components\":[{\"internalType\":\"address\",\"name\":\"addr\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"votingPower\",\"type\":\"uint256\"}],\"internalType\":\"struct Autonity.CommitteeMember[]\",\"name\":\"\",\"type\":\"tuple[]\"}],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"startId\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"lastId\",\"type\":\"uint256\"}],\"name\":\"getBondingReq\",\"outputs\":[{\"components\":[{\"internalType\":\"address payable\",\"name\":\"delegator\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"delegatee\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"startBlock\",\"type\":\"uint256\"}],\"internalType\":\"struct Autonity.Staking[]\",\"name\":\"\",\"type\":\"tuple[]\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"getCommittee\",\"outputs\":[{\"components\":[{\"internalType\":\"address\",\"name\":\"addr\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"votingPower\",\"type\":\"uint256\"}],\"internalType\":\"struct Autonity.CommitteeMember[]\",\"name\":\"\",\"type\":\"tuple[]\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"getCommitteeEnodes\",\"outputs\":[{\"internalType\":\"string[]\",\"name\":\"\",\"type\":\"string[]\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"getDoubleMaxCommitteeSize\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"getMaxCommitteeSize\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"getMinimumBaseFee\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"getNewContract\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"getOperator\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"height\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"round\",\"type\":\"uint256\"}],\"name\":\"getProposer\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"startId\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"lastId\",\"type\":\"uint256\"}],\"name\":\"getUnbondingReq\",\"outputs\":[{\"components\":[{\"internalType\":\"address payable\",\"name\":\"delegator\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"delegatee\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"startBlock\",\"type\":\"uint256\"}],\"internalType\":\"struct Autonity.Staking[]\",\"name\":\"\",\"type\":\"tuple[]\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"_addr\",\"type\":\"address\"}],\"name\":\"getValidator\",\"outputs\":[{\"components\":[{\"internalType\":\"address payable\",\"name\":\"treasury\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"addr\",\"type\":\"address\"},{\"internalType\":\"string\",\"name\":\"enode\",\"type\":\"string\"},{\"internalType\":\"uint256\",\"name\":\"commissionRate\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"bondedStake\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"selfBondedStake\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"totalSlashed\",\"type\":\"uint256\"},{\"internalType\":\"contract Liquid\",\"name\":\"liquidContract\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"liquidSupply\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"registrationBlock\",\"type\":\"uint256\"},{\"internalType\":\"enum Autonity.ValidatorState\",\"name\":\"state\",\"type\":\"uint8\"}],\"internalType\":\"struct Autonity.Validator\",\"name\":\"\",\"type\":\"tuple\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"getValidators\",\"outputs\":[{\"internalType\":\"address[]\",\"name\":\"\",\"type\":\"address[]\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"getVersion\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"headBondingID\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"headUnbondingID\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"lastEpochBlock\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"_addr\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"_amount\",\"type\":\"uint256\"}],\"name\":\"mint\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"name\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"pure\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"string\",\"name\":\"_enode\",\"type\":\"string\"}],\"name\":\"registerValidator\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"_size\",\"type\":\"uint256\"}],\"name\":\"setCommitteeSize\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"_period\",\"type\":\"uint256\"}],\"name\":\"setEpochPeriod\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"_price\",\"type\":\"uint256\"}],\"name\":\"setMinimumBaseFee\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"_account\",\"type\":\"address\"}],\"name\":\"setOperatorAccount\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address payable\",\"name\":\"_account\",\"type\":\"address\"}],\"name\":\"setTreasuryAccount\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"_treasuryFee\",\"type\":\"uint256\"}],\"name\":\"setTreasuryFee\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"_period\",\"type\":\"uint256\"}],\"name\":\"setUnbondingPeriod\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"symbol\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"pure\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"tailBondingID\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"tailUnbondingID\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"totalRedistributed\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"totalSupply\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"_recipient\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"_amount\",\"type\":\"uint256\"}],\"name\":\"transfer\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"sender\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"recipient\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"transferFrom\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"_validator\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"_amount\",\"type\":\"uint256\"}],\"name\":\"unbond\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"string\",\"name\":\"_bytecode\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"_abi\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"_version\",\"type\":\"string\"}],\"name\":\"upgradeContract\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"stateMutability\":\"payable\",\"type\":\"receive\"}]"
)

var (
	// new settings to be submitted for protocol in testcase.
	newMinBaseFee      = new(big.Int).SetUint64(20)
	newCommitteeSize   = new(big.Int).SetUint64(10)
	newUnBondingPeriod = new(big.Int).SetUint64(30)
	newEpochPeriod     = new(big.Int).SetUint64(45)
	newTreasuryFee     = new(big.Int).SetUint64(10)
	mintAmount         = new(big.Int).SetUint64(100)
	burnAmount         = new(big.Int).SetUint64(50)
)

// test registerValidator, unRegisterValidators, bond and unbond operations.
func TestACPublicWritters(t *testing.T) {
	numOfValidators := 2

	operator, err := makeAccount()
	require.NoError(t, err)
	operatorAddr := crypto.PubkeyToAddress(operator.PublicKey)

	newValidator, err := makeAccount()
	require.NoError(t, err)
	newValidatorAddr := crypto.PubkeyToAddress(newValidator.PublicKey)
	enodeUrl := enode.V4DNSUrl(newValidator.PublicKey, "127.0.0.1", 30303, 30303) + ":30303"

	// newton to be mint
	amount := new(big.Int).SetUint64(10)

	cases := []*testCase{
		{
			name:          "Test register new validator",
			numValidators: numOfValidators,
			numBlocks:     10,
			txPerPeer:     1,
			// register validator right after block #5 is committed from client V0.
			afterHooks: map[string]hook{
				"V0": registerValidatorHook(map[uint64]struct{}{
					5: {},
				},
					enodeUrl,
				),
			},
			finalAssert: func(t *testing.T, validators map[string]*testNode) {
				client := interact(validators["V0"].rpcPort)
				defer client.close()
				val, err := client.call(validators["V0"].lastBlock).getValidator(newValidatorAddr)
				require.NoError(t, err)
				require.Equal(t, newValidatorAddr, val.Addr)
			},
		},
		{
			name:          "bond stake to validator",
			numValidators: numOfValidators,
			numBlocks:     10,
			txPerPeer:     1,
			genesisHook: func(g *core.Genesis) *core.Genesis {
				g.Config.AutonityContractConfig.Operator = operatorAddr
				// pre-mine Auton for system operator and new validator.
				g.Alloc[operatorAddr] = core.GenesisAccount{
					Balance: new(big.Int).Exp(big.NewInt(2), big.NewInt(128), nil),
				}
				g.Alloc[newValidatorAddr] = core.GenesisAccount{
					Balance: new(big.Int).Exp(big.NewInt(2), big.NewInt(128), nil),
				}
				return g
			},
			// mint newton for new validator right after block #3 via client V0.
			// bond newton to validator right after block #7 via client V1.
			afterHooks: map[string]hook{
				"V0": mintStakeHook(map[uint64]struct{}{
					2: {},
				},
					operator,
					newValidator,
					amount,
				),
				"V1": bondStakeHook(map[uint64]struct{}{
					7: {},
				},
					newValidator,
					amount,
				),
			},
			finalAssert: func(t *testing.T, validators map[string]*testNode) {
				node := validators["V1"]
				client := interact(node.rpcPort)
				defer client.close()
				reqs, err := client.call(node.lastBlock).getBondingReq(new(big.Int).SetUint64(0),
					new(big.Int).SetUint64(3))
				require.NoError(t, err)
				require.Equal(t, node.EthAddress(), reqs[2].Delegatee)
				require.Equal(t, newValidatorAddr, reqs[2].Delegator)
				require.Equal(t, amount, reqs[2].Amount)
			},
		},
		{
			name:          "unbond stake from validator",
			numValidators: numOfValidators,
			numBlocks:     10,
			txPerPeer:     1,
			afterHooks: map[string]hook{
				"V0": unBondStakeHook(map[uint64]struct{}{
					2: {},
				},
					amount,
				),
			},
			finalAssert: func(t *testing.T, validators map[string]*testNode) {
				node := validators["V0"]
				client := interact(node.rpcPort)
				defer client.close()
				reqs, err := client.call(node.lastBlock).getUnBondingReq(new(big.Int).SetUint64(0),
					new(big.Int).SetUint64(1))
				require.NoError(t, err)
				require.Equal(t, node.EthAddress(), reqs[0].Delegatee)
				require.Equal(t, node.EthAddress(), reqs[0].Delegator)
				require.Equal(t, amount, reqs[0].Amount)
			},
		},
	}

	for _, testcase := range cases {
		runTest(t, testcase)
	}
}

// test system settings management by operator account.
func TestACSystemOperatorOPs(t *testing.T) {
	numOfValidators := 3
	initialOperator, err := makeAccount()
	require.NoError(t, err)
	initialOperatorAddr := crypto.PubkeyToAddress(initialOperator.PublicKey)

	newOperator, err := makeAccount()
	require.NoError(t, err)
	newOperatorAddr := crypto.PubkeyToAddress(newOperator.PublicKey)

	testCase := &testCase{
		name:          "Test AC system operator change settings",
		numValidators: numOfValidators,
		numBlocks:     15,
		txPerPeer:     1,
		// set AC configs in genesis hook.
		genesisHook: func(g *core.Genesis) *core.Genesis {
			g.Config.AutonityContractConfig.Operator = initialOperatorAddr
			g.Alloc[initialOperatorAddr] = core.GenesisAccount{
				Balance: new(big.Int).Exp(big.NewInt(2), big.NewInt(128), nil),
			}
			g.Alloc[newOperatorAddr] = core.GenesisAccount{
				Balance: new(big.Int).Exp(big.NewInt(2), big.NewInt(128), nil),
			}
			setACConfig(g.Config.AutonityContractConfig)
			return g
		},
		afterHooks: map[string]hook{
			// change settings right after block #1 is committed from client V0.
			"V0": changeSettingHook(
				map[uint64]struct{}{
					1: {},
				},
				initialOperator,
				newOperatorAddr,
			),
			// burn stake right after block #5 from client V1.
			"V1": burnStakeHook(
				map[uint64]struct{}{
					5: {},
				},
				initialOperator,
				newOperatorAddr,
			),
			// change operator after block #10 from client V3.
			"V2": setOperatorHook(
				map[uint64]struct{}{
					10: {},
				},
				initialOperator,
				newOperatorAddr,
			),
		},
		finalAssert: func(t *testing.T, validators map[string]*testNode) {
			node := validators["V0"]
			client := interact(node.rpcPort)
			defer client.close()
			mBaseFee, err := client.call(node.lastBlock).getMinBaseFee()
			require.NoError(t, err)
			require.Equal(t, newMinBaseFee.Uint64(), mBaseFee.Uint64())
			comSize, err := client.call(node.lastBlock).getMaxCommitteeSize()
			require.NoError(t, err)
			require.Equal(t, newCommitteeSize.Uint64(), comSize.Uint64())
			newOP, err := client.call(node.lastBlock).getOperator()
			require.NoError(t, err)
			require.Equal(t, newOperatorAddr, newOP)
			balance, err := client.call(node.lastBlock).balanceOf(newOperatorAddr)
			require.NoError(t, err)
			require.Equal(t, mintAmount.Sub(mintAmount, burnAmount).Uint64(), balance.Uint64())

			// new operator can change settings after the account update without revert error.
			_, err = client.tx(newOperator).setEpochPeriod(new(big.Int).SetUint64(45))
			require.NoError(t, err)
		},
	}
	runTest(t, testCase)
}

// test system settings / state getters
func TestACStateGetters(t *testing.T) {
	operatorKey, err := makeAccount()
	require.NoError(t, err)
	operatorAddress := crypto.PubkeyToAddress(operatorKey.PublicKey)
	numOfValidators := 2
	testCase := &testCase{
		name:          "Test AC state getters",
		numValidators: numOfValidators,
		numBlocks:     10,
		txPerPeer:     1,
		// set AC configs in genesis hook.
		genesisHook: func(g *core.Genesis) *core.Genesis {
			g.Config.AutonityContractConfig.Operator = operatorAddress
			g.Config.AutonityContractConfig.Treasury = operatorAddress
			setACConfig(g.Config.AutonityContractConfig)
			return g
		},
		// start AC state getter verifications right after block #5 is committed from client V0.
		afterHooks: map[string]hook{
			"V0": acStateGettersHook(map[uint64]struct{}{
				5: {},
			},
				operatorAddress,
				numOfValidators,
			),
		},
	}
	runTest(t, testCase)
}

func burnStakeHook(upgradeBlocks map[uint64]struct{}, op *ecdsa.PrivateKey, ac common.Address) hook {
	return func(block *types.Block, validator *testNode, tCase *testCase, currentTime time.Time) error {
		blockNum := block.Number().Uint64()
		if _, ok := upgradeBlocks[blockNum]; !ok {
			return nil
		}
		interaction := interact(validator.rpcPort)
		defer interaction.close()
		if _, err := interaction.tx(op).burn(ac, burnAmount); err != nil {
			return err
		}
		return nil
	}
}

func setOperatorHook(upgradeBlocks map[uint64]struct{}, operator *ecdsa.PrivateKey, opAddr common.Address) hook {
	return func(block *types.Block, validator *testNode, tCase *testCase, currentTime time.Time) error {
		blockNum := block.Number().Uint64()
		if _, ok := upgradeBlocks[blockNum]; !ok {
			return nil
		}
		interaction := interact(validator.rpcPort)
		defer interaction.close()
		if _, err := interaction.tx(operator).setOperator(opAddr); err != nil {
			return err
		}
		return nil
	}
}

func changeSettingHook(upgradeBlocks map[uint64]struct{}, opKey *ecdsa.PrivateKey, newOpAddr common.Address) hook {
	return func(block *types.Block, validator *testNode, tCase *testCase, currentTime time.Time) error {
		blockNum := block.Number().Uint64()
		if _, ok := upgradeBlocks[blockNum]; !ok {
			return nil
		}
		interaction := interact(validator.rpcPort)
		defer interaction.close()
		if _, err := interaction.tx(opKey).setMinBaseFee(newMinBaseFee); err != nil {
			return err
		}
		if _, err := interaction.tx(opKey).setCommitteeSize(newCommitteeSize); err != nil {
			return err
		}
		if _, err := interaction.tx(opKey).setUnBondingPeriod(newUnBondingPeriod); err != nil {
			return err
		}
		if _, err := interaction.tx(opKey).setEpochPeriod(newEpochPeriod); err != nil {
			return err
		}
		if _, err := interaction.tx(opKey).setTreasuryAccount(newOpAddr); err != nil {
			return err
		}
		if _, err := interaction.tx(opKey).setTreasuryFee(newTreasuryFee); err != nil {
			return err
		}
		if _, err := interaction.tx(opKey).mint(newOpAddr, mintAmount); err != nil {
			return err
		}
		return nil
	}
}

func unBondStakeHook(upgradeBlocks map[uint64]struct{}, amount *big.Int) hook {
	return func(block *types.Block, validator *testNode, tCase *testCase, currentTime time.Time) error {
		blockNum := block.Number().Uint64()
		if _, ok := upgradeBlocks[blockNum]; !ok {
			return nil
		}
		interaction := interact(validator.rpcPort)
		defer interaction.close()
		if _, err := interaction.tx(validator.privateKey).unbond(validator.EthAddress(), amount); err != nil {
			return err
		}
		return nil
	}
}

func bondStakeHook(upgradeBlocks map[uint64]struct{}, newVal *ecdsa.PrivateKey, amount *big.Int) hook {
	return func(block *types.Block, validator *testNode, tCase *testCase, currentTime time.Time) error {
		blockNum := block.Number().Uint64()
		if _, ok := upgradeBlocks[blockNum]; !ok {
			return nil
		}
		interaction := interact(validator.rpcPort)
		defer interaction.close()
		if _, err := interaction.tx(newVal).bond(validator.EthAddress(), amount); err != nil {
			return err
		}
		return nil
	}
}

func mintStakeHook(upgradeBlocks map[uint64]struct{}, operator *ecdsa.PrivateKey, newVal *ecdsa.PrivateKey, amount *big.Int) hook {
	return func(block *types.Block, validator *testNode, tCase *testCase, currentTime time.Time) error {
		blockNum := block.Number().Uint64()
		if _, ok := upgradeBlocks[blockNum]; !ok {
			return nil
		}
		interaction := interact(validator.rpcPort)
		defer interaction.close()
		newValAddr := crypto.PubkeyToAddress(newVal.PublicKey)
		if _, err := interaction.tx(operator).mint(newValAddr, amount); err != nil {
			return err
		}
		return nil
	}
}

func registerValidatorHook(upgradeBlocks map[uint64]struct{}, enode string) hook {
	return func(block *types.Block, validator *testNode, tCase *testCase, currentTime time.Time) error {
		blockNum := block.Number().Uint64()
		if _, ok := upgradeBlocks[blockNum]; !ok {
			return nil
		}
		interaction := interact(validator.rpcPort)
		defer interaction.close()
		if _, err := interaction.tx(validator.privateKey).registerValidator(enode); err != nil {
			return err
		}
		return nil
	}
}

func acStateGettersHook(upgradeBlocks map[uint64]struct{}, operator common.Address, numVals int) hook {
	return func(block *types.Block, validator *testNode, tCase *testCase, currentTime time.Time) error {
		blockNum := block.Number().Uint64()
		if _, ok := upgradeBlocks[blockNum]; !ok {
			return nil
		}
		interaction := interact(validator.rpcPort)
		defer interaction.close()

		if err := checkVersion(interaction, blockNum, defaultVersion); err != nil {
			return err
		}

		if err := checkCommittee(interaction, blockNum, numVals); err != nil {
			return err
		}

		if err := checkValidators(interaction, blockNum, numVals); err != nil {
			return err
		}

		if err := checkValidator(interaction, blockNum, validator.EthAddress(), validator.netNode.url); err != nil {
			return err
		}

		if err := checkMaxCommitteeSize(interaction, blockNum, maxCommitteeSize); err != nil {
			return err
		}

		if err := checkCommitteeEnodes(interaction, blockNum, numVals); err != nil {
			return err
		}

		if err := checkMinBaseFee(interaction, blockNum, minBaseFee); err != nil {
			return err
		}

		if err := checkOperatorAddress(interaction, blockNum, operator); err != nil {
			return err
		}

		if err := checkNewContract(interaction, blockNum, "", ""); err != nil {
			return err
		}

		start := new(big.Int).SetUint64(0)
		end := new(big.Int).SetUint64(uint64(numVals))
		if err := checkBondingReqs(interaction, blockNum, start, end, numVals); err != nil {
			return err
		}
		if err := checkUnBondingReqs(interaction, blockNum, start, end, numVals); err != nil {
			return err
		}
		return nil
	}
}

func checkVersion(client *interactor, height uint64, expected string) error {
	version, err := client.call(height).getVersion()
	if err != nil {
		return err
	}
	if version != expected {
		return fmt.Errorf("unexpected version")
	}
	return nil
}

func checkMaxCommitteeSize(client *interactor, height uint64, size int) error {
	maxSize, err := client.call(height).getMaxCommitteeSize()
	if err != nil {
		return err
	}
	if maxSize.Uint64() != uint64(size) {
		return fmt.Errorf("unexpected max committee size")
	}
	return nil
}

// todo: check each enode urls
func checkCommitteeEnodes(client *interactor, height uint64, numEnodes int) error {
	enodes, err := client.call(height).getCommitteeEnodes()
	if err != nil {
		return err
	}
	if len(enodes) != numEnodes {
		return fmt.Errorf("unexpected committee enodes")
	}
	return nil
}

// todo: get committtee from genesis file, and check them on each seat
func checkCommittee(client *interactor, height uint64, lenCommittee int) error {
	committee, err := client.call(height).getCommittee()
	if err != nil {
		return err
	}
	if len(committee) != lenCommittee {
		return fmt.Errorf("unexpected committee")
	}
	return nil
}

// todo: check each validator
func checkValidators(client *interactor, height uint64, numVals int) error {
	vals, err := client.call(height).getValidators()
	if err != nil {
		return err
	}
	if len(vals) != numVals {
		return fmt.Errorf("unexpected validators")
	}
	return nil
}

// todo: check each property of validator
func checkValidator(client *interactor, height uint64, address common.Address, enode string) error {
	val, err := client.call(height).getValidator(address)
	if err != nil {
		return err
	}
	if enode != val.Enode {
		return fmt.Errorf("unexpected validator")
	}
	return nil
}

func checkMinBaseFee(client *interactor, height uint64, minBaseFee int) error {
	fee, err := client.call(height).getMinBaseFee()
	if err != nil {
		return err
	}
	if fee.Uint64() != uint64(minBaseFee) {
		return fmt.Errorf("unexpected min base fee")
	}
	return nil
}

func checkOperatorAddress(client *interactor, height uint64, opAddr common.Address) error {
	op, err := client.call(height).getOperator()
	if err != nil {
		return err
	}
	if op != opAddr {
		return fmt.Errorf("unexpected operator account")
	}
	return nil
}

func checkNewContract(client *interactor, height uint64, byteCode string, abi string) error {
	byteC, a, err := client.call(height).getNewContract()
	if err != nil {
		return err
	}
	if byteC != byteCode && a != abi {
		return fmt.Errorf("unexpected new contract")
	}
	return nil
}

// todo check each bonding requests
func checkBondingReqs(client *interactor, height uint64, s *big.Int, e *big.Int, num int) error {
	reqs, err := client.call(height).getBondingReq(s, e)
	if err != nil {
		return err
	}
	if len(reqs) != num {
		return fmt.Errorf("unexpected bonding reqs")
	}
	return nil
}

// todo check each unbonding requests.
func checkUnBondingReqs(client *interactor, height uint64, s *big.Int, e *big.Int, num int) error {
	reqs, err := client.call(height).getUnBondingReq(s, e)
	if err != nil {
		return err
	}
	if len(reqs) != num {
		return fmt.Errorf("unexpected unbonding reqs")
	}
	return nil
}

// Test the contract upgrade mechanism.
// The new contract is ./autonity/solidity/contracts/Upgrade_test.sol
func TestUpgradeMechanism(t *testing.T) {
	numOfValidators := 3
	operator, err := makeAccount()
	require.NoError(t, err)
	initialOperatorAddr := crypto.PubkeyToAddress(operator.PublicKey)
	var upgradeTx *types.Transaction
	testCase := &testCase{
		name:          "Test AC system operator change settings",
		numValidators: numOfValidators,
		numBlocks:     15,
		txPerPeer:     1,
		// set AC configs in genesis hook.
		genesisHook: func(g *core.Genesis) *core.Genesis {
			g.Config.AutonityContractConfig.Operator = initialOperatorAddr
			g.Alloc[initialOperatorAddr] = core.GenesisAccount{
				Balance: new(big.Int).Exp(big.NewInt(2), big.NewInt(128), nil),
			}
			setACConfig(g.Config.AutonityContractConfig)
			return g
		},
		afterHooks: map[string]hook{
			// upgrade is triggered at block #5
			"V0": func(block *types.Block, validator *testNode, tCase *testCase, currentTime time.Time) error {
				if block.Number().Uint64() == 5 {
					interaction := interact(validator.rpcPort)
					defer interaction.close()
					var err error
					if upgradeTx, err = interaction.tx(operator).upgradeContract(contractUpgradeBytecode, contractUpgradeABI, "v2.0.0"); err != nil {
						return err
					}
				}
				return nil
			},
			// modified transfer is triggered at block #10
			"V1": func(block *types.Block, validator *testNode, tCase *testCase, currentTime time.Time) error {
				if block.Number().Uint64() == 10 {
					interaction := interact(validator.rpcPort)
					defer interaction.close()
					if _, err = interaction.tx(operator).transfer(common.HexToAddress("0x111"), big.NewInt(1000)); err != nil {
						return err
					}
				}
				return nil
			},
		},

		finalAssert: func(t *testing.T, validators map[string]*testNode) {
			node := validators["V0"]
			client := interact(node.rpcPort)
			defer client.close()
			upgradeReceipt, err := client.client.TransactionReceipt(context.Background(), upgradeTx.Hash())
			require.NoError(t, err)
			t.Log("upgrade gas used:", upgradeReceipt.GasUsed)
			//check that validator 1 has 50 bonded stake. (initial stake is 100)
			val1, err := client.call(node.lastBlock).getValidator(validators["V1"].address)
			require.NoError(t, err)
			require.Equal(t, uint64(50), val1.BondedStake.Uint64())
			//check the contract version is now 2.0.0
			version, err := client.call(node.lastBlock).getVersion()
			require.NoError(t, err)
			require.Equal(t, "2.0.0", version)
			//check the new transfer operation
			balance, err := client.call(15).balanceOf(common.HexToAddress("0x111"))
			require.NoError(t, err)
			require.Equal(t, big.NewInt(2000), balance)
		},
	}
	runTest(t, testCase)
}

func makeAccount() (*ecdsa.PrivateKey, error) {
	return crypto.GenerateKey()
}

func setACConfig(contractConf *params.AutonityContractGenesis) {
	contractConf.BlockPeriod = uint64(blockPeriod)
	contractConf.DelegationRate = uint64(delegationRate)
	contractConf.MaxCommitteeSize = uint64(maxCommitteeSize)
	contractConf.EpochPeriod = uint64(epochPeriod)
	contractConf.MinBaseFee = uint64(minBaseFee)
	contractConf.UnbondingPeriod = uint64(unBondingPeriod)
	contractConf.TreasuryFee = uint64(treasuryFee)
}
